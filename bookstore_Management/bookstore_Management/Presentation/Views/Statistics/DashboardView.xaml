<UserControl x:Class="bookstore_Management.Views.Statistics.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             Background="{StaticResource BackgroundBrush}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Presentation/AppResources/Styles/StatisticStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header with Date Filter -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <TextBlock Text="THỐNG KÊ" Style="{StaticResource PageTitle}"/>

                <Border Style="{StaticResource DateFilterBorder}"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="📅" Margin="0,0,5,0"/>
                        <TextBlock Text="Ngày kết thúc" Style="{StaticResource DateFilterText}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Top Section: Customer Distribution & Top Categories -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Customer Distribution Card -->
                <Border Grid.Column="0" Style="{StaticResource StatCardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,-16,0,15">
                            <Border Style="{StaticResource IconContainer}"
                                    Background="{StaticResource CustomerIconBackgroundBrush}">
                                <TextBlock Text="👥" FontSize="16" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Phân loại Khách hàng" Style="{StaticResource CardHeaderText}"/>
                        </StackPanel>

                        <!-- Pie Chart -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <lvc:PieChart Grid.Column="0"
                                          Series="{Binding CustomerDistributionSeries}"
                                          LegendLocation="None"
                                          InnerRadius="60"
                                          Height="200"/>

                            <!-- Legend -->
                            <StackPanel Grid.Column="1" 
                                        VerticalAlignment="Center"
                                        Margin="20,0,0,0">

                                <!-- Total Customers -->
                                <Border Style="{StaticResource TotalCustomerCard}">
                                    <StackPanel>
                                        <TextBlock Text="👥" FontSize="24" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding TotalCustomers}" 
                                                   Style="{StaticResource TotalCustomerNumber}"/>
                                        <TextBlock Text="Số lượng khách hàng" 
                                                   Style="{StaticResource SubtitleText}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Member -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <Ellipse Style="{StaticResource LegendDot}" 
                                             Fill="{StaticResource PieChartMemberBrush}"/>
                                    <TextBlock Text="Thành Viên" Style="{StaticResource LegendText}"/>
                                </StackPanel>
                                <TextBlock Text="80%" 
                                           Style="{StaticResource LegendPercentage}"
                                           Margin="20,0,0,10"/>

                                <!-- Regular -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <Ellipse Style="{StaticResource LegendDot}" 
                                             Fill="{StaticResource PieChartRegularBrush}"/>
                                    <TextBlock Text="Vãng Lai" Style="{StaticResource LegendText}"/>
                                </StackPanel>
                                <TextBlock Text="20%" 
                                           Style="{StaticResource LegendPercentage}"
                                           Margin="20,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Top 5 Categories Card -->
                <Border Grid.Column="2" Style="{StaticResource StatCardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,-16,0,15">
                            <Border Style="{StaticResource IconContainer}"
                                    Background="{StaticResource CategoryIconBackgroundBrush}">
                                <TextBlock Text="📊" FontSize="16" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Top 5 thể loại bán chạy" 
                                       Style="{StaticResource CardHeaderText}"/>
                        </StackPanel>

                        <!-- Bar Chart -->
                        <lvc:CartesianChart Grid.Row="1" 
                                            Series="{Binding TopCategoriesSeries}"
                                            Height="200"
                                            Margin="0,10,0,10">
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis ShowLabels="False"/>
                            </lvc:CartesianChart.AxisY>
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis ShowLabels="False"/>
                            </lvc:CartesianChart.AxisX>
                        </lvc:CartesianChart>

                        <!-- Legend -->
                        <UniformGrid Grid.Row="2" 
                                     Columns="3" 
                                     Rows="2"
                                     HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Ellipse Style="{StaticResource SmallLegendDot}" 
                                         Fill="{StaticResource Chart1Brush}"/>
                                <TextBlock Text="Sách thiếu nhi" 
                                           Style="{StaticResource LegendSmallText}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Ellipse Style="{StaticResource SmallLegendDot}" 
                                         Fill="{StaticResource Chart2Brush}"/>
                                <TextBlock Text="Văn học" 
                                           Style="{StaticResource LegendSmallText}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Ellipse Style="{StaticResource SmallLegendDot}" 
                                         Fill="{StaticResource Chart3Brush}"/>
                                <TextBlock Text="Kinh tế" 
                                           Style="{StaticResource LegendSmallText}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Ellipse Style="{StaticResource SmallLegendDot}" 
                                         Fill="{StaticResource Chart4Brush}"/>
                                <TextBlock Text="Tâm lý" 
                                           Style="{StaticResource LegendSmallText}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Ellipse Style="{StaticResource SmallLegendDot}" 
                                         Fill="{StaticResource Chart5Brush}"/>
                                <TextBlock Text="Sách giáo khoa" 
                                           Style="{StaticResource LegendSmallText}"/>
                            </StackPanel>
                        </UniformGrid>
                    </Grid>
                </Border>
            </Grid>

            <!-- Bottom Section: Revenue & Profit/Cost -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Revenue Chart Card -->
                <Border Grid.Column="0" Style="{StaticResource StatCardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,-16,0,15">
                            <Border Style="{StaticResource IconContainer}"
                                    Background="{StaticResource RevenueIconBackgroundBrush}">
                                <TextBlock Text="📈" FontSize="16" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Xu hướng Doanh thu 30 Ngày gần nhất" 
                                       Style="{StaticResource CardHeaderText}"/>
                        </StackPanel>

                        <!-- Line Chart -->
                        <lvc:CartesianChart Grid.Row="1" 
                                            Series="{Binding RevenueSeries}"
                                            Height="300">
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Doanh thu (Tr VNĐ)" 
                                          FontSize="11"
                                          Foreground="{StaticResource AxisTextBrush}"/>
                            </lvc:CartesianChart.AxisY>
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding RevenueLabels}"
                                          FontSize="10"
                                          Foreground="{StaticResource AxisTextBrush}"/>
                            </lvc:CartesianChart.AxisX>
                        </lvc:CartesianChart>
                    </Grid>
                </Border>

                <!-- Profit/Cost Chart Card -->
                <Border Grid.Column="2" Style="{StaticResource StatCardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,-16,0,15">
                            <Border Style="{StaticResource IconContainer}"
                                    Background="{StaticResource ProfitIconBackgroundBrush}">
                                <TextBlock Text="💰" FontSize="16" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Lợi nhuận/Chi phí" 
                                       Style="{StaticResource CardHeaderText}"/>
                        </StackPanel>

                        <!-- Horizontal Bar Chart -->
                        <lvc:CartesianChart Grid.Row="1" 
                                            Series="{Binding ProfitCostSeries}"
                                            Height="300">
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Labels="{Binding ProfitCostLabels}"
                                          FontSize="11"
                                          Foreground="{StaticResource LegendTextBrush}"/>
                            </lvc:CartesianChart.AxisY>
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis FontSize="10"
                                          Foreground="{StaticResource AxisTextBrush}"/>
                            </lvc:CartesianChart.AxisX>
                        </lvc:CartesianChart>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>